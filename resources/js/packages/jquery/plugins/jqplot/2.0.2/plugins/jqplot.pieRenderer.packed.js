(function($){$.jqplot.PieRenderer=function(){$.jqplot.LineRenderer.call(this)};$.jqplot.PieRenderer.prototype=new $.jqplot.LineRenderer();$.jqplot.PieRenderer.prototype.constructor=$.jqplot.PieRenderer;$.jqplot.PieRenderer.prototype.init=function(a,b){this.diameter=null;this.padding=20;this.sliceMargin=0;this.fill=true;this.shadowOffset=2;this.shadowAlpha=0.07;this.shadowDepth=5;this.highlightMouseOver=true;this.highlightMouseDown=false;this.highlightColors=[];this.dataLabels='percent';this.showDataLabels=false;this.dataLabelFormatString=null;this.dataLabelThreshold=3;this.dataLabelPositionFactor=0.52;this.dataLabelNudge=2;this.dataLabelCenterOn=true;this.startAngle=0;this.tickRenderer=$.jqplot.PieTickRenderer;this._drawData=true;this._type='pie';if(a.highlightMouseDown&&a.highlightMouseOver==null){a.highlightMouseOver=false}$.extend(true,this,a);if(this.sliceMargin<0){this.sliceMargin=0}this._diameter=null;this._radius=null;this._sliceAngles=[];this._highlightedPoint=null;if(this.highlightColors.length==0){for(var i=0;i<this.seriesColors.length;i++){var c=$.jqplot.getColorComponents(this.seriesColors[i]);var d=[c[0],c[1],c[2]];var e=d[0]+d[1]+d[2];for(var j=0;j<3;j++){d[j]=(e>570)?d[j]*0.8:d[j]+0.3*(255-d[j]);d[j]=parseInt(d[j],10)}this.highlightColors.push('rgb('+d[0]+','+d[1]+','+d[2]+')')}}this.highlightColorGenerator=new $.jqplot.ColorGenerator(this.highlightColors);b.postParseOptionsHooks.addOnce(postParseOptions);b.postInitHooks.addOnce(postInit);b.eventListenerHooks.addOnce('jqplotMouseMove',handleMove);b.eventListenerHooks.addOnce('jqplotMouseDown',handleMouseDown);b.eventListenerHooks.addOnce('jqplotMouseUp',handleMouseUp);b.eventListenerHooks.addOnce('jqplotClick',handleClick);b.eventListenerHooks.addOnce('jqplotRightClick',handleRightClick);b.postDrawHooks.addOnce(postPlotDraw)};$.jqplot.PieRenderer.prototype.setGridData=function(a){var b=[];var c=[];var d=this.startAngle/180*Math.PI;var e=0;this._drawData=false;for(var i=0;i<this.data.length;i++){if(this.data[i][1]!=0){this._drawData=true}b.push(this.data[i][1]);c.push([this.data[i][0]]);if(i>0){b[i]+=b[i-1]}e+=this.data[i][1]}var f=Math.PI*2/b[b.length-1];for(var i=0;i<b.length;i++){c[i][1]=b[i]*f;c[i][2]=this.data[i][1]/e}this.gridData=c};$.jqplot.PieRenderer.prototype.makeGridData=function(a,b){var c=[];var d=[];var e=0;var f=this.startAngle/180*Math.PI;this._drawData=false;for(var i=0;i<a.length;i++){if(this.data[i][1]!=0){this._drawData=true}c.push(a[i][1]);d.push([a[i][0]]);if(i>0){c[i]+=c[i-1]}e+=a[i][1]}var g=Math.PI*2/c[c.length-1];for(var i=0;i<c.length;i++){d[i][1]=c[i]*g;d[i][2]=a[i][1]/e}return d};function calcRadiusAdjustment(a){return Math.sin((a-(a-Math.PI)/8/Math.PI)/2.0)}function calcRPrime(a,b,c,d,e){var f=0;var g=b-a;var h=Math.abs(g);var i=c;if(d==false){i+=e}if(i>0&&h>0.01&&h<6.282){f=parseFloat(i)/2.0/calcRadiusAdjustment(g)}return f}$.jqplot.PieRenderer.prototype.drawSlice=function(b,c,d,e,f){if(this._drawData){var r=this._radius;var g=this.fill;var h=this.lineWidth;var j=this.sliceMargin;if(this.fill==false){j+=this.lineWidth}b.save();b.translate(this._center[0],this._center[1]);var k=calcRPrime(c,d,this.sliceMargin,this.fill,this.lineWidth);var m=k*Math.cos((c+d)/2.0);var n=k*Math.sin((c+d)/2.0);if((d-c)<=Math.PI){r-=k}else{r+=k}b.translate(m,n);if(f){for(var i=0,l=this.shadowDepth;i<l;i++){b.save();b.translate(this.shadowOffset*Math.cos(this.shadowAngle/180*Math.PI),this.shadowOffset*Math.sin(this.shadowAngle/180*Math.PI));doDraw(r)}for(var i=0,l=this.shadowDepth;i<l;i++){b.restore()}}else{doDraw(r)}b.restore()}function doDraw(a){if(d>6.282+this.startAngle){d=6.282+this.startAngle;if(c>d){c=6.281+this.startAngle}}if(c>=d){return}b.beginPath();b.fillStyle=e;b.strokeStyle=e;b.lineWidth=h;b.arc(0,0,a,c,d,false);b.lineTo(0,0);b.closePath();if(g){b.fill()}else{b.stroke()}}};$.jqplot.PieRenderer.prototype.draw=function(a,b,c,e){var i;var f=(c!=undefined)?c:{};var g=0;var j=0;var k=1;var m=new $.jqplot.ColorGenerator(this.seriesColors);if(c.legendInfo&&c.legendInfo.placement=='insideGrid'){var n=c.legendInfo;switch(n.location){case'nw':g=n.width+n.xoffset;break;case'w':g=n.width+n.xoffset;break;case'sw':g=n.width+n.xoffset;break;case'ne':g=n.width+n.xoffset;k=-1;break;case'e':g=n.width+n.xoffset;k=-1;break;case'se':g=n.width+n.xoffset;k=-1;break;case'n':j=n.height+n.yoffset;break;case's':j=n.height+n.yoffset;k=-1;break;default:break}}var o=(f.shadow!=undefined)?f.shadow:this.shadow;var p=(f.fill!=undefined)?f.fill:this.fill;var q=a.canvas.width;var s=a.canvas.height;var w=q-g-2*this.padding;var h=s-j-2*this.padding;var t=Math.min(w,h);var d=t;this._sliceAngles=[];var u=this.sliceMargin;if(this.fill==false){u+=this.lineWidth}var v;var z=0;var A,ang1,ang2,shadowColor;var B=this.startAngle/180*Math.PI;for(var i=0,l=b.length;i<l;i++){ang1=(i==0)?B:b[i-1][1]+B;ang2=b[i][1]+B;this._sliceAngles.push([ang1,ang2]);v=calcRPrime(ang1,ang2,this.sliceMargin,this.fill,this.lineWidth);if(Math.abs(ang2-ang1)>Math.PI){z=Math.max(v,z)}}if(this.diameter!=null&&this.diameter>0){this._diameter=this.diameter-2*z}else{this._diameter=d-2*z}if(this._diameter<6){$.jqplot.log('Diameter of pie too small, not rendering.');return}var r=this._radius=this._diameter/2;this._center=[(q-k*g)/2+k*g+z*Math.cos(B),(s-k*j)/2+k*j+z*Math.sin(B)];if(this.shadow){for(var i=0,l=b.length;i<l;i++){shadowColor='rgba(0,0,0,'+this.shadowAlpha+')';this.renderer.drawSlice.call(this,a,this._sliceAngles[i][0],this._sliceAngles[i][1],shadowColor,true)}}for(var i=0;i<b.length;i++){this.renderer.drawSlice.call(this,a,this._sliceAngles[i][0],this._sliceAngles[i][1],m.next(),false);if(this.showDataLabels&&b[i][2]*100>=this.dataLabelThreshold){var C,avgang=(this._sliceAngles[i][0]+this._sliceAngles[i][1])/2,label;if(this.dataLabels=='label'){C=this.dataLabelFormatString||'%s';label=$.jqplot.sprintf(C,b[i][0])}else if(this.dataLabels=='value'){C=this.dataLabelFormatString||'%d';label=$.jqplot.sprintf(C,this.data[i][1])}else if(this.dataLabels=='percent'){C=this.dataLabelFormatString||'%d%%';label=$.jqplot.sprintf(C,b[i][2]*100)}else if(this.dataLabels.constructor==Array){C=this.dataLabelFormatString||'%s';label=$.jqplot.sprintf(C,this.dataLabels[i])}var D=(this._radius)*this.dataLabelPositionFactor+this.sliceMargin+this.dataLabelNudge;var x=this._center[0]+Math.cos(avgang)*D+this.canvas._offsets.left;var y=this._center[1]+Math.sin(avgang)*D+this.canvas._offsets.top;var E=$('<div class="jqplot-pie-series jqplot-data-label" style="position:absolute;">'+label+'</div>').insertBefore(e.eventCanvas._elem);if(this.dataLabelCenterOn){x-=E.width()/2;y-=E.height()/2}else{x-=E.width()*Math.sin(avgang/2);y-=E.height()/2}x=Math.round(x);y=Math.round(y);E.css({left:x,top:y})}}};$.jqplot.PieAxisRenderer=function(){$.jqplot.LinearAxisRenderer.call(this)};$.jqplot.PieAxisRenderer.prototype=new $.jqplot.LinearAxisRenderer();$.jqplot.PieAxisRenderer.prototype.constructor=$.jqplot.PieAxisRenderer;$.jqplot.PieAxisRenderer.prototype.init=function(a){this.tickRenderer=$.jqplot.PieTickRenderer;$.extend(true,this,a);this._dataBounds={min:0,max:100};this.min=0;this.max=100;this.showTicks=false;this.ticks=[];this.showMark=false;this.show=false};$.jqplot.PieLegendRenderer=function(){$.jqplot.TableLegendRenderer.call(this)};$.jqplot.PieLegendRenderer.prototype=new $.jqplot.TableLegendRenderer();$.jqplot.PieLegendRenderer.prototype.constructor=$.jqplot.PieLegendRenderer;$.jqplot.PieLegendRenderer.prototype.init=function(a){this.numberRows=null;this.numberColumns=null;$.extend(true,this,a)};$.jqplot.PieLegendRenderer.prototype.draw=function(){var a=this;if(this.show){var b=this._series;this._elem=$(document.createElement('div'));this._elem.addClass('jqplot-div-legend');this._table=$(document.createElement('table'));this._table.addClass('jqplot-table-legend jqplot-table-legend-table');var c={position:'absolute'};if(this.background){c['background']=this.background}if(this.border){c['border']=this.border}if(this.fontSize){c['fontSize']=this.fontSize}if(this.fontFamily){c['fontFamily']=this.fontFamily}if(this.textColor){c['textColor']=this.textColor}if(this.marginTop!=null){c['marginTop']=this.marginTop}if(this.marginBottom!=null){c['marginBottom']=this.marginBottom}if(this.marginLeft!=null){c['marginLeft']=this.marginLeft}if(this.marginRight!=null){c['marginRight']=this.marginRight}if(this.width!=null){c['width']=this.width}this._elem.css(c);var d=false,reverse=false,nr,nc;var s=b[0];var e=new $.jqplot.ColorGenerator(s.seriesColors);if(s.show){var f=s.data;if(this.numberRows){nr=this.numberRows;if(!this.numberColumns){nc=Math.ceil(f.length/nr)}else{nc=this.numberColumns}}else if(this.numberColumns){nc=this.numberColumns;nr=Math.ceil(f.length/this.numberColumns)}else{nr=f.length;nc=1}var i,j;var g,td1,td2,td3,td4;var h,rs,color;var k=0;var l,div1,div2,a0,btn0;var m,data2,dynpadleft,tdwidth,divwidth,img1;for(i=0;i<nr;i++){g=$(document.createElement('tr'));g.addClass('jqplot-table-legend jqplot-table-legend-tr');if(reverse){g.prependTo(this._table)}else{g.appendTo(this._table)}for(j=0;j<nc;j++){if(k<f.length){h=this.labels[k]||f[k][0].toString();m=(f[k][1])?f[k][1]:0;dynpadleft=10;divwidth=16;tdwidth=16;color=e.next();if(!reverse){if(i>0){d=true}else{d=false}}else{if(i==nr-1){d=false}else{d=true}}rs=(d)?this.rowSpacing:'0';td1=$(document.createElement('td'));td1.addClass('jqplot-table-legend jqplot-table-legend-swatch jqplot-table-legend-td jqplot-table-legend-td-first width16');td1.css({textAlign:'center'});l=$(document.createElement('div'));l.addClass('jqplot-table-legend-swatch-outline');div1=$(document.createElement('div'));div1.addClass('jqplot-table-legend-swatch');div1.css({backgroundColor:color,borderColor:color});div2=$(document.createElement('div'));div2.addClass('scrollTitle scrollTitlePollChart');a0=$(document.createElement('a'));a0.attr('href','javascript:void(0)');td1.append(l.append(div1));td2=$(document.createElement('td'));td2.addClass('jqplot-table-legend jqplot-table-legend-label jqplot-table-legend-td jqplot-table-legend-td-nowrap');img1=$(document.createElement('img'));img1.attr('src','/pub/img/icons/core_16x16/img_poll_voters_list.png');a1=$(document.createElement('a'));if(m){a1.attr('href','javascript:void(0)').attr('title','View the '+m+' voter'+((parseInt(m)==1)?'':'s')+' for this item');a1.css({textDecoration:'none',border:'none'});a1.unbind('click').bind('click',function(){getPollVoters(this)})}div3=$(document.createElement('div'));div3.css({width:divwidth+'px'});td3=$(document.createElement('td'));td3.addClass('jqplot-table-legend jqplot-table-legend-swatch jqplot-table-legend-td jqplot-table-legend-td-last width16');td3.css({textAlign:'center'});if(this.escapeHtml){a0.text(h);if(m){a1.text(m)}}else{a0.html(h);if(m){a1.append(img1)}}td2.append(div2.append(a0));td3.append(div3.append(a1));if(reverse){td3.prependTo(g);td2.prependTo(g);td1.prependTo(g)}else{td1.appendTo(g);td2.appendTo(g);td3.appendTo(g)}d=true}k++}}}this._elem.append(this._table)}return this._elem};$.jqplot.PieRenderer.prototype.handleMove=function(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data];e.target.trigger('jqplotDataMouseOver',f);if(e.series[f[0]].highlightMouseOver&&!(f[0]==e.plugins.pieRenderer.highlightedSeriesIndex&&f[1]==e.series[f[0]]._highlightedPoint)){e.target.trigger('jqplotDataHighlight',f);highlight(e,f[0],f[1])}}else if(d==null){unhighlight(e)}};function preInit(a,b,c){c=c||{};c.axesDefaults=c.axesDefaults||{};c.legend=c.legend||{};c.seriesDefaults=c.seriesDefaults||{};var d=false;if(c.seriesDefaults.renderer==$.jqplot.PieRenderer){d=true}else if(c.series){for(var i=0;i<c.series.length;i++){if(c.series[i].renderer==$.jqplot.PieRenderer){d=true}}}if(d){c.axesDefaults.renderer=$.jqplot.PieAxisRenderer;c.legend.renderer=$.jqplot.PieLegendRenderer;c.legend.preDraw=true;c.seriesDefaults.pointLabels={show:false}}}function postInit(a,b,c){for(var i=0;i<this.series.length;i++){if(this.series[i].renderer.constructor==$.jqplot.PieRenderer){if(this.series[i].highlightMouseOver){this.series[i].highlightMouseDown=false}}}}function postParseOptions(a){for(var i=0;i<this.series.length;i++){this.series[i].seriesColors=this.seriesColors;this.series[i].colorGenerator=$.jqplot.colorGenerator}}function highlight(a,b,c){var s=a.series[b];var d=a.plugins.pieRenderer.highlightCanvas;d._ctx.clearRect(0,0,d._ctx.canvas.width,d._ctx.canvas.height);s._highlightedPoint=c;a.plugins.pieRenderer.highlightedSeriesIndex=b;s.renderer.drawSlice.call(s,d._ctx,s._sliceAngles[c][0],s._sliceAngles[c][1],s.highlightColorGenerator.get(c),false)}function unhighlight(a){var b=a.plugins.pieRenderer.highlightCanvas;b._ctx.clearRect(0,0,b._ctx.canvas.width,b._ctx.canvas.height);for(var i=0;i<a.series.length;i++){a.series[i]._highlightedPoint=null}a.plugins.pieRenderer.highlightedSeriesIndex=null;a.target.trigger('jqplotDataUnhighlight')}function handleMove(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data];var g=jQuery.Event('jqplotDataMouseOver');g.pageX=a.pageX;g.pageY=a.pageY;e.target.trigger(g,f);if(e.series[f[0]].highlightMouseOver&&!(f[0]==e.plugins.pieRenderer.highlightedSeriesIndex&&f[1]==e.series[f[0]]._highlightedPoint)){var h=jQuery.Event('jqplotDataHighlight');h.which=a.which;h.pageX=a.pageX;h.pageY=a.pageY;e.target.trigger(h,f);highlight(e,f[0],f[1])}}else if(d==null){unhighlight(e)}}function handleMouseDown(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data];if(e.series[f[0]].highlightMouseDown&&!(f[0]==e.plugins.pieRenderer.highlightedSeriesIndex&&f[1]==e.series[f[0]]._highlightedPoint)){var g=jQuery.Event('jqplotDataHighlight');g.which=a.which;g.pageX=a.pageX;g.pageY=a.pageY;e.target.trigger(g,f);highlight(e,f[0],f[1])}}else if(d==null){unhighlight(e)}}function handleMouseUp(a,b,c,d,e){var f=e.plugins.pieRenderer.highlightedSeriesIndex;if(f!=null&&e.series[f].highlightMouseDown){unhighlight(e)}}function handleClick(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data];var g=jQuery.Event('jqplotDataClick');g.which=a.which;g.pageX=a.pageX;g.pageY=a.pageY;e.target.trigger(g,f)}}function handleRightClick(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data];var g=e.plugins.pieRenderer.highlightedSeriesIndex;if(g!=null&&e.series[g].highlightMouseDown){unhighlight(e)}var h=jQuery.Event('jqplotDataRightClick');h.which=a.which;h.pageX=a.pageX;h.pageY=a.pageY;e.target.trigger(h,f)}}function postPlotDraw(){if(this.plugins.pieRenderer&&this.plugins.pieRenderer.highlightCanvas){this.plugins.pieRenderer.highlightCanvas.resetCanvas();this.plugins.pieRenderer.highlightCanvas=null}this.plugins.pieRenderer={highlightedSeriesIndex:null};this.plugins.pieRenderer.highlightCanvas=new $.jqplot.GenericCanvas();var b=$(this.targetId+' .jqplot-data-label');if(b.length){$(b[0]).before(this.plugins.pieRenderer.highlightCanvas.createElement(this._gridPadding,'jqplot-pieRenderer-highlight-canvas',this._plotDimensions,this))}else{this.eventCanvas._elem.before(this.plugins.pieRenderer.highlightCanvas.createElement(this._gridPadding,'jqplot-pieRenderer-highlight-canvas',this._plotDimensions,this))}var c=this.plugins.pieRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind('mouseleave',{plot:this},function(a){unhighlight(a.data.plot)})}$.jqplot.preInitHooks.push(preInit);$.jqplot.PieTickRenderer=function(){$.jqplot.AxisTickRenderer.call(this)};$.jqplot.PieTickRenderer.prototype=new $.jqplot.AxisTickRenderer();$.jqplot.PieTickRenderer.prototype.constructor=$.jqplot.PieTickRenderer})(jQuery);
