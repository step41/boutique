(function(g,$,h){'use strict';var k=$.event,dispatchMethod=$.event.handle?'handle':'dispatch',resizeTimeout;k.special.smartresize={setup:function(){$(this).bind("resize",k.special.smartresize.handler)},teardown:function(){$(this).unbind("resize",k.special.smartresize.handler)},handler:function(a,b){var c=this,args=arguments;a.type="smartresize";if(resizeTimeout){clearTimeout(resizeTimeout)}resizeTimeout=setTimeout(function(){k[dispatchMethod].apply(c,args)},b==="execAsap"?0:100)}};$.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])};$.Mason=function(a,b){this.element=$(b);this._create(a);this._init()};$.Mason.settings={msgAlert:'',isResizable:true,isAnimated:false,animationOptions:{queue:false,duration:500},gutterWidth:0,isRTL:false,isFitWidth:false,containerStyle:{position:'relative'}};$.Mason.prototype={_filterFindBricks:function(a){var b=this.options.itemSelector;return!b?a:a.filter(b).add(a.find(b))},_getBricks:function(a){var b=this._filterFindBricks(a).css({position:'absolute'}).addClass('masonry-brick');return b},_create:function(a){this.options=$.extend(true,{},$.Mason.settings,a);this.styleQueue=[];var b=this.element[0].style;this.originalStyle={height:b.height||''};var c=this.options.containerStyle;for(var d in c){this.originalStyle[d]=b[d]||''}this.element.css(c);this.horizontalDirection=this.options.isRTL?'right':'left';var x=this.element.css('padding-'+this.horizontalDirection);var y=this.element.css('padding-top');this.offset={x:x?parseInt(x,10):0,y:y?parseInt(y,10):0};this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth==='function';var e=this;setTimeout(function(){e.element.addClass('masonry')},0);if(this.options.isResizable){$(g).bind('smartresize.masonry',function(){e.resize()})}this.reloadItems()},_init:function(a){this._getColumns();this._reLayout(a)},option:function(a,b){if($.isPlainObject(a)){this.options=$.extend(true,this.options,a)}},layout:function(a,b){this.options.msgAlert='';for(var i=0,len=a.length;i<len;i++){this._placeBrick(a[i])}if(this.options.msgAlert){alert(this.options.msgAlert)}var c={};c.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var d=0;i=this.cols;while(--i){if(this.colYs[i]!==0){break}d++}c.width=(this.cols-d)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:c});var e=!this.isLaidOut?'css':(this.options.isAnimated?'animate':'css'),animOpts=this.options.animationOptions;var f;for(i=0,len=this.styleQueue.length;i<len;i++){f=this.styleQueue[i];f.$el[e](f.style,animOpts)}this.styleQueue=[];if(b){b.call(a)}this.isLaidOut=true},_getColumns:function(){var a=this.options.isFitWidth?this.element.parent():this.element,containerWidth=a.width();this.columnWidth=this.isFluid?this.options.columnWidth(containerWidth):this.options.columnWidth||this.$bricks.outerWidth(true)||containerWidth;this.columnWidth+=this.options.gutterWidth;this.cols=Math.floor((containerWidth+this.options.gutterWidth)/this.columnWidth);this.cols=Math.max(this.cols,1)},_placeBrick:function(a){var b=$(a),colSpan,groupCount,groupY,groupColY,j;colSpan=Math.ceil(b.outerWidth(true)/this.columnWidth);colSpan=Math.min(colSpan,this.cols);if(colSpan===1){groupY=this.colYs}else{groupCount=this.cols+1-colSpan;groupY=[];for(j=0;j<groupCount;j++){groupColY=this.colYs.slice(j,j+colSpan);groupY[j]=Math.max.apply(Math,groupColY)}}var c=Math.min.apply(Math,groupY),shortCol=0;for(var i=0,len=groupY.length;i<len;i++){if(groupY[i]===c){shortCol=i;break}}var d={top:c+this.offset.y};d[this.horizontalDirection]=this.columnWidth*shortCol+this.offset.x;this.styleQueue.push({$el:b,style:d});var e=c+b.outerHeight(true),setSpan=this.cols+1-len;for(i=0;i<setSpan;i++){this.colYs[shortCol+i]=e}},resize:function(){var a=this.cols;this._getColumns();if(this.isFluid||this.cols!==a){this._reLayout()}},_reLayout:function(a){var i=this.cols;this.colYs=[];while(i--){this.colYs.push(0)}this.layout(this.$bricks,a)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(a){this.reloadItems();this._init(a)},appended:function(a,b,c){if(b){this._filterFindBricks(a).css({top:this.element.height()});var d=this;setTimeout(function(){d._appended(a,c)},1)}else{this._appended(a,c)}},_appended:function(a,b){var c=this._getBricks(a);this.$bricks=this.$bricks.add(c);this.layout(c,b)},remove:function(a){this.$bricks=this.$bricks.not(a);a.remove()},destroy:function(){this.$bricks.removeClass('masonry-brick').each(function(){this.style.position='';this.style.top='';this.style.left=''});var a=this.element[0].style;for(var b in this.originalStyle){a[b]=this.originalStyle[b]}this.element.attr('style',false).unbind('.masonry').removeClass('masonry').removeData('masonry');$(g).unbind('.masonry')}};$.fn.imagesLoaded=function(c){var d=this,$images=d.find('img').add(d.filter('img')),len=$images.length,blank='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==',loaded=[];function triggerCallback(){c.call(d,$images)}function imgLoaded(a){var b=a.target;if(b.src!==blank&&$.inArray(b,loaded)===-1){loaded.push(b);if(--len<=0){setTimeout(triggerCallback);$images.unbind('.imagesLoaded',imgLoaded)}}}if(!len){triggerCallback()}$images.bind('load.imagesLoaded error.imagesLoaded',imgLoaded).each(function(){var a=this.src;this.src=blank;this.src=a});return d};var l=function(a){if(g.console){g.console.error(a)}};$.fn.masonry=function(b){if(typeof b==='string'){var c=Array.prototype.slice.call(arguments,1);this.each(function(){var a=$.data(this,'masonry');if(!a){l("cannot call methods on masonry prior to initialization; "+"attempted to call method '"+b+"'");return}if(!$.isFunction(a[b])||b.charAt(0)==="_"){l("no such method '"+b+"' for masonry instance");return}a[b].apply(a,c)})}else{this.each(function(){var a=$.data(this,'masonry');if(a){a.option(b||{});a._init()}else{$.data(this,'masonry',new $.Mason(b,this))}})}return this}})(window,jQuery);
