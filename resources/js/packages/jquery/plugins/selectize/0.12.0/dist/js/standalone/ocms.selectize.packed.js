(function(a,b){if(typeof define==='function'&&define.amd){define('sifter',b)}else if(typeof exports==='object'){module.exports=b()}else{a.Sifter=b()}}(this,function(){var j=function(a,b){this.items=a;this.settings=b||{diacritics:true}};j.prototype.tokenize=function(a){a=o(String(a||'').toLowerCase());if(!a||!a.length)return[];var i,n,regex,letter;var b=[];var c=a.split(/ +/);for(i=0,n=c.length;i<n;i++){regex=p(c[i]);if(this.settings.diacritics){for(letter in r){if(r.hasOwnProperty(letter)){regex=regex.replace(new RegExp(letter,'g'),r[letter])}}}b.push({string:c[i],regex:new RegExp(regex,'i')})}return b};j.prototype.iterator=function(c,d){var e;if(q(c)){e=Array.prototype.forEach||function(a){for(var i=0,n=this.length;i<n;i++){a(this[i],i,this)}}}else{e=function(a){for(var b in this){if(this.hasOwnProperty(b)){a(this[b],b,this)}}}}e.apply(c,[d])};j.prototype.getScoreFunction=function(d,e){var f,fields,tokens,token_count;f=this;d=f.prepareSearch(d,e);tokens=d.tokens;fields=d.options.fields;token_count=tokens.length;var g=function(a,b){var c,pos;if(!a)return 0;a=String(a||'');pos=a.search(b.regex);if(pos===-1)return 0;c=b.string.length/a.length;if(pos===0)c+=0.5;return c};var h=(function(){var c=fields.length;if(!c){return function(){return 0}}if(c===1){return function(a,b){return g(b[fields[0]],a)}}return function(a,b){for(var i=0,sum=0;i<c;i++){sum+=g(b[fields[i]],a)}return sum/c}})();if(!token_count){return function(){return 0}}if(token_count===1){return function(a){return h(tokens[0],a)}}if(d.options.conjunction==='and'){return function(a){var b;for(var i=0,sum=0;i<token_count;i++){b=h(tokens[i],a);if(b<=0)return 0;sum+=b}return sum/token_count}}else{return function(a){for(var i=0,sum=0;i<token_count;i++){sum+=h(tokens[i],a)}return sum/token_count}}};j.prototype.getSortFunction=function(c,d){var i,n,self,field,fields,fields_count,multiplier,multipliers,get_field,implicit_score,sort;self=this;c=self.prepareSearch(c,d);sort=(!c.query&&d.sort_empty)||d.sort;get_field=function(a,b){if(a==='$score')return b.score;return self.items[b.id][a]};fields=[];if(sort){for(i=0,n=sort.length;i<n;i++){if(c.query||sort[i].field!=='$score'){fields.push(sort[i])}}}if(c.query){implicit_score=true;for(i=0,n=fields.length;i<n;i++){if(fields[i].field==='$score'){implicit_score=false;break}}if(implicit_score){fields.unshift({field:'$score',direction:'desc'})}}else{for(i=0,n=fields.length;i<n;i++){if(fields[i].field==='$score'){fields.splice(i,1);break}}}multipliers=[];for(i=0,n=fields.length;i<n;i++){multipliers.push(fields[i].direction==='desc'?-1:1)}fields_count=fields.length;if(!fields_count){return null}else if(fields_count===1){field=fields[0].field;multiplier=multipliers[0];return function(a,b){return multiplier*l(get_field(field,a),get_field(field,b))}}else{return function(a,b){var i,result,a_value,b_value,field;for(i=0;i<fields_count;i++){field=fields[i].field;result=multipliers[i]*l(get_field(field,a),get_field(field,b));if(result)return result}return 0}}};j.prototype.prepareSearch=function(a,b){if(typeof a==='object')return a;b=m({},b);var c=b.fields;var d=b.sort;var e=b.sort_empty;if(c&&!q(c))b.fields=[c];if(d&&!q(d))b.sort=[d];if(e&&!q(e))b.sort_empty=[e];return{options:b,query:String(a||'').toLowerCase(),tokens:this.tokenize(a),total:0,items:[]}};j.prototype.search=function(c,d){var e=this,value,score,search,calculateScore;var f;var g;search=this.prepareSearch(c,d);d=search.options;c=search.query;g=d.score||e.getScoreFunction(search);if(c.length){e.iterator(e.items,function(a,b){score=g(a);if(d.filter===false||score>0){search.items.push({'score':score,'id':b})}})}else{e.iterator(e.items,function(a,b){search.items.push({'score':1,'id':b})})}f=e.getSortFunction(search,d);if(f)search.items.sort(f);search.total=search.items.length;if(typeof d.limit==='number'){search.items=search.items.slice(0,d.limit)}return search};var l=function(a,b){if(typeof a==='number'&&typeof b==='number'){return a>b?1:(a<b?-1:0)}a=s(String(a||''));b=s(String(b||''));if(a>b)return 1;if(b>a)return-1;return 0};var m=function(a,b){var i,n,k,object;for(i=1,n=arguments.length;i<n;i++){object=arguments[i];if(!object)continue;for(k in object){if(object.hasOwnProperty(k)){a[k]=object[k]}}}return a};var o=function(a){return(a+'').replace(/^\s+|\s+$|/g,'')};var p=function(a){return(a+'').replace(/([.?*+^$[\]\\(){}|-])/g,'\\$1')};var q=Array.isArray||($&&Array.isArray)||function(a){return Object.prototype.toString.call(a)==='[object Array]'};var r={'a':'[aÀÁÂÃÄÅàáâãäåĀāąĄ]','c':'[cÇçćĆčČ]','d':'[dđĐďĎ]','e':'[eÈÉÊËèéêëěĚĒēęĘ]','i':'[iÌÍÎÏìíîïĪī]','l':'[lłŁ]','n':'[nÑñňŇńŃ]','o':'[oÒÓÔÕÕÖØòóôõöøŌō]','r':'[rřŘ]','s':'[sŠšśŚ]','t':'[tťŤ]','u':'[uÙÚÛÜùúûüůŮŪū]','y':'[yŸÿýÝ]','z':'[zŽžżŻźŹ]'};var s=(function(){var i,n,k,chunk;var c='';var d={};for(k in r){if(r.hasOwnProperty(k)){chunk=r[k].substring(2,r[k].length-1);c+=chunk;for(i=0,n=chunk.length;i<n;i++){d[chunk.charAt(i)]=k}}}var e=new RegExp('['+c+']','g');return function(b){return b.replace(e,function(a){return d[a]}).toLowerCase()}})();return j}));(function(a,b){if(typeof define==='function'&&define.amd){define('microplugin',b)}else if(typeof exports==='object'){module.exports=b()}else{a.MicroPlugin=b()}}(this,function(){var f={};f.mixin=function(e){e.plugins={};e.prototype.initializePlugins=function(a){var i,n,key;var b=this;var c=[];b.plugins={names:[],settings:{},requested:{},loaded:{}};if(g.isArray(a)){for(i=0,n=a.length;i<n;i++){if(typeof a[i]==='string'){c.push(a[i])}else{b.plugins.settings[a[i].name]=a[i].options;c.push(a[i].name)}}}else if(a){for(key in a){if(a.hasOwnProperty(key)){b.plugins.settings[key]=a[key];c.push(key)}}}while(c.length){b.require(c.shift())}};e.prototype.loadPlugin=function(a){var b=this;var c=b.plugins;var d=e.plugins[a];if(!e.plugins.hasOwnProperty(a)){throw new Error('Unable to find "'+a+'" plugin');}c.requested[a]=true;c.loaded[a]=d.fn.apply(b,[b.plugins.settings[a]||{}]);c.names.push(a)};e.prototype.require=function(a){var b=this;var c=b.plugins;if(!b.plugins.loaded.hasOwnProperty(a)){if(c.requested[a]){throw new Error('Plugin has circular dependency ("'+a+'")');}b.loadPlugin(a)}return c.loaded[a]};e.define=function(a,b){e.plugins[a]={'name':a,'fn':b}}};var g={isArray:Array.isArray||function(a){return Object.prototype.toString.call(a)==='[object Array]'}};return f}));(function(a,b){if(typeof define==='function'&&define.amd){define('selectize',['jquery','sifter','microplugin'],b)}else if(typeof exports==='object'){module.exports=b(require('jquery'),require('sifter'),require('microplugin'))}else{a.Selectize=b(a.jQuery,a.Sifter,a.MicroPlugin)}}(this,function($,z,A){'use strict';var B=function(j,k){if(typeof k==='string'&&!k.length)return;var l=(typeof k==='string')?new RegExp(k,'i'):k;var m=function(a){var b=0;if(a.nodeType===3){var c=a.data.search(l);if(c>=0&&a.data.length>0){var d=a.data.match(l);var e=document.createElement('span');e.className='highlight';var f=a.splitText(c);var g=f.splitText(d[0].length);var h=f.cloneNode(true);e.appendChild(h);f.parentNode.replaceChild(e,f);b=1}}else if(a.nodeType===1&&a.childNodes&&!/(script|style)/i.test(a.tagName)){for(var i=0;i<a.childNodes.length;++i){i+=m(a.childNodes[i])}}return b};return j.each(function(){m(this)})};var C=function(){};C.prototype={on:function(a,b){this._events=this._events||{};this._events[a]=this._events[a]||[];this._events[a].push(b)},off:function(a,b){var n=arguments.length;if(n===0)return delete this._events;if(n===1)return delete this._events[a];this._events=this._events||{};if(a in this._events===false)return;this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){this._events=this._events||{};if(a in this._events===false)return;for(var i=0;i<this._events[a].length;i++){this._events[a][i].apply(this,Array.prototype.slice.call(arguments,1))}}};C.mixin=function(a){var b=['on','off','trigger'];for(var i=0;i<b.length;i++){a.prototype[b[i]]=C.prototype[b[i]]}};var D=/Mac/.test(navigator.userAgent);var E=65;var F=188;var G=13;var H=27;var I=37;var J=38;var K=80;var L=39;var M=40;var N=78;var O=8;var P=46;var Q=16;var R=D?91:17;var S=D?18:17;var T=9;var U=1;var V=2;var W=!/android/i.test(window.navigator.userAgent)&&!!document.createElement('form').validity;var X=function(a){return typeof a!=='undefined'};var Y=function(a){if(typeof a==='undefined'||a===null)return null;if(typeof a==='boolean')return a?'1':'0';return a+''};var Z=function(a){return(a+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')};var ba=function(a){return(a+'').replace(/\$/g,'$$$$')};var bb={};bb.before=function(a,b,c){var d=a[b];a[b]=function(){c.apply(a,arguments);return d.apply(a,arguments)}};bb.after=function(b,c,d){var e=b[c];b[c]=function(){var a=e.apply(b,arguments);d.apply(b,arguments);return a}};var bc=function(a){var b=false;return function(){if(b)return;b=true;a.apply(this,arguments)}};var bd=function(c,d){var e;return function(){var a=this;var b=arguments;window.clearTimeout(e);e=window.setTimeout(function(){c.apply(a,b)},d)}};var be=function(b,c,d){var e;var f=b.trigger;var g={};b.trigger=function(){var a=arguments[0];if(c.indexOf(a)!==-1){g[a]=arguments}else{return f.apply(b,arguments)}};d.apply(b,[]);b.trigger=f;for(e in g){if(g.hasOwnProperty(e)){f.apply(b,g[e])}}};var bf=function(b,c,d,f){b.on(c,d,function(e){var a=e.target;while(a&&a.parentNode!==b[0]){a=a.parentNode}e.currentTarget=a;return f.apply(this,[e])})};var bg=function(a){var b={};if('selectionStart'in a){b.start=a.selectionStart;b.length=a.selectionEnd-b.start}else if(document.selection){a.focus();var c=document.selection.createRange();var d=document.selection.createRange().text.length;c.moveStart('character',-a.value.length);b.start=c.text.length-d;b.length=d}return b};var bh=function(a,b,c){var i,n,styles={};if(c){for(i=0,n=c.length;i<n;i++){styles[c[i]]=a.css(c[i])}}else{styles=a.css()}b.css(styles)};var bi=function(a,b){if(!a){return 0}var c=$('<test>').css({position:'absolute',top:-99999,left:-99999,width:'auto',padding:0,whiteSpace:'pre'}).text(a).appendTo('body');bh(b,c,['letterSpacing','fontSize','fontFamily','fontWeight','textTransform']);var d=c.width();c.remove();return parseInt(d+16)};var bj=function(d){var f=null;var g=function(e,a){var b,keyCode,printable,placeholder,width;var c,character,selection;e=e||window.event||{};a=a||{};if(e.metaKey||e.altKey)return;if(!a.force&&d.data('grow')===false)return;b=d.val();if(e.type&&e.type.toLowerCase()==='keydown'){keyCode=e.keyCode;printable=((keyCode>=97&&keyCode<=122)||(keyCode>=65&&keyCode<=90)||(keyCode>=48&&keyCode<=57)||keyCode===32);if(keyCode===P||keyCode===O){selection=bg(d[0]);if(selection.length){b=b.substring(0,selection.start)+b.substring(selection.start+selection.length)}else if(keyCode===O&&selection.start){b=b.substring(0,selection.start-1)+b.substring(selection.start+1)}else if(keyCode===P&&typeof selection.start!=='undefined'){b=b.substring(0,selection.start)+b.substring(selection.start+1)}}else if(printable){c=e.shiftKey;character=String.fromCharCode(e.keyCode);if(c)character=character.toUpperCase();else character=character.toLowerCase();b+=character}}placeholder=d.attr('placeholder');if(!b&&placeholder){b=placeholder}width=bi(b,d)+4;if(width!==f){f=width;d.width(width);d.triggerHandler('resize')}};d.on('keydown keyup update blur',g);g()};var bk=function(a,b){var c,i,n,dir,input,self=this;input=a[0];input.selectize=self;var d=window.getComputedStyle&&window.getComputedStyle(input,null);dir=d?d.getPropertyValue('direction'):input.currentStyle&&input.currentStyle.direction;dir=dir||a.parents('[dir]:first').attr('dir')||'';$.extend(self,{order:0,settings:b,$input:a,tabIndex:a.attr('tabindex')||'',tagType:input.tagName.toLowerCase()==='select'?U:V,rtl:/rtl/i.test(dir),eventNS:'.selectize'+(++bk.count),highlightedValue:null,isOpen:false,isDisabled:false,isRequired:a.is('[required]'),isInvalid:false,isLocked:false,isFocused:false,isInputHidden:false,isSetup:false,isShiftDown:false,isCmdDown:false,isCtrlDown:false,ignoreFocus:false,ignoreBlur:false,ignoreHover:false,hasOptions:false,currentResults:null,lastValue:'',caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:b.loadThrottle===null?self.onSearchChange:bd(self.onSearchChange,b.loadThrottle)});self.sifter=new z(this.options,{diacritics:b.diacritics});if(self.settings.options){for(i=0,n=self.settings.options.length;i<n;i++){self.registerOption(self.settings.options[i])}delete self.settings.options}if(self.settings.optgroups){for(i=0,n=self.settings.optgroups.length;i<n;i++){self.registerOptionGroup(self.settings.optgroups[i])}delete self.settings.optgroups}self.settings.mode=self.settings.mode||(self.settings.maxItems===1?'single':'multi');if(typeof self.settings.hideSelected!=='boolean'){self.settings.hideSelected=self.settings.mode==='multi'}self.initializePlugins(self.settings.plugins);self.setupCallbacks();self.setupTemplates();self.setup()};C.mixin(bk);A.mixin(bk);$.extend(bk.prototype,{setup:function(){var a=this;var b=a.settings;var c=a.eventNS;var d=$(window);var f=$(document);var g=a.$input;var h;var i;var j;var k;var l;var m;var n;var o;var p;var q;var r;n=a.settings.mode;q=g.attr('class')||'';h=$('<div>').addClass(b.wrapperClass).addClass(q).addClass(n);i=$('<div>').addClass(b.inputClass).addClass('items').appendTo(h);j=$('<input type="text" autocomplete="off" />').appendTo(i).attr('tabindex',g.is(':disabled')?'-1':a.tabIndex);m=$(b.dropdownParent||h);k=$('<div>').addClass(b.dropdownClass).addClass(n).hide().appendTo(m);l=$('<div>').addClass(b.dropdownContentClass).appendTo(k);if(a.settings.copyClassesToDropdown){k.addClass(q)}h.css({width:g[0].style.width});if(a.plugins.names.length){r='plugin-'+a.plugins.names.join(' plugin-');h.addClass(r);k.addClass(r)}if((b.maxItems===null||b.maxItems>1)&&a.tagType===U){g.attr('multiple','multiple')}if(a.settings.placeholder){j.attr('placeholder',b.placeholder)}if(!a.settings.splitOn&&a.settings.delimiter){var s=a.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&');a.settings.splitOn=new RegExp('\\s*'+s+'+\\s*')}if(g.attr('autocorrect')){j.attr('autocorrect',g.attr('autocorrect'))}if(g.attr('autocapitalize')){j.attr('autocapitalize',g.attr('autocapitalize'))}a.$wrapper=h;a.$control=i;a.$control_input=j;a.$dropdown=k;a.$dropdown_content=l;k.on('mouseenter','[data-selectable]',function(){return a.onOptionHover.apply(a,arguments)});k.on('mousedown click','[data-selectable]',function(){return a.onOptionSelect.apply(a,arguments)});bf(i,'mousedown','*:not(input)',function(){return a.onItemSelect.apply(a,arguments)});bj(j);i.on({mousedown:function(){return a.onMouseDown.apply(a,arguments)},click:function(){return a.onClick.apply(a,arguments)}});j.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return a.onKeyDown.apply(a,arguments)},keyup:function(){return a.onKeyUp.apply(a,arguments)},keypress:function(){return a.onKeyPress.apply(a,arguments)},resize:function(){a.positionDropdown.apply(a,[])},blur:function(){return a.onBlur.apply(a,arguments)},focus:function(){a.ignoreBlur=false;return a.onFocus.apply(a,arguments)},paste:function(){return a.onPaste.apply(a,arguments)}});f.on('keydown'+c,function(e){a.isCmdDown=e[D?'metaKey':'ctrlKey'];a.isCtrlDown=e[D?'altKey':'ctrlKey'];a.isShiftDown=e.shiftKey});f.on('keyup'+c,function(e){if(e.keyCode===S)a.isCtrlDown=false;if(e.keyCode===Q)a.isShiftDown=false;if(e.keyCode===R)a.isCmdDown=false});f.on('mousedown'+c,function(e){if(a.isFocused){if(e.target===a.$dropdown[0]||e.target.parentNode===a.$dropdown[0]){return false}if(!a.$control.has(e.target).length&&e.target!==a.$control[0]){a.blur(e.target)}}});d.on(['scroll'+c,'resize'+c].join(' '),function(){if(a.isOpen){a.positionDropdown.apply(a,arguments)}});d.on('mousemove'+c,function(){a.ignoreHover=false});this.revertSettings={$children:g.children().detach(),tabindex:g.attr('tabindex')};g.attr('tabindex',-1).hide().after(a.$wrapper);if(Array.isArray(b.items)){a.setValue(b.items);delete b.items}if(W){g.on('invalid'+c,function(e){e.preventDefault();a.isInvalid=true;a.refreshState()})}a.updateOriginalInput();a.refreshItems();a.refreshState();a.updatePlaceholder();a.isSetup=true;if(g.is(':disabled')){a.disable()}a.on('change',this.onChange);g.data('selectize',a);g.addClass('selectized');a.trigger('initialize');if(b.preload===true){a.onSearchChange('')}},setupTemplates:function(){var c=this;var d=c.settings.labelField;var e=c.settings.optgroupLabelField;var f={'optgroup':function(a){return'<div class="optgroup">'+a.html+'</div>'},'optgroup_header':function(a,b){return'<div class="optgroup-header">'+b(a[e])+'</div>'},'option':function(a,b){return'<div class="option">'+b(a[d])+'</div>'},'item':function(a,b){return'<div class="item">'+b(a[d])+'</div>'},'option_create':function(a,b){return'<div class="create">Add <strong>'+b(a.input)+'</strong>&hellip;</div>'}};c.settings.render=$.extend({},f,c.settings.render)},setupCallbacks:function(){var a,fn,callbacks={'initialize':'onInitialize','change':'onChange','item_add':'onItemAdd','item_remove':'onItemRemove','clear':'onClear','option_add':'onOptionAdd','option_remove':'onOptionRemove','option_clear':'onOptionClear','optgroup_add':'onOptionGroupAdd','optgroup_remove':'onOptionGroupRemove','optgroup_clear':'onOptionGroupClear','dropdown_open':'onDropdownOpen','dropdown_close':'onDropdownClose','type':'onType','load':'onLoad','focus':'onFocus','blur':'onBlur'};for(a in callbacks){if(callbacks.hasOwnProperty(a)){fn=this.settings[callbacks[a]];if(fn)this.on(a,fn)}}},onClick:function(e){var a=this;if(!a.isFocused){a.focus();e.preventDefault()}},onMouseDown:function(e){var a=this;var b=e.isDefaultPrevented();var c=$(e.target);if(a.isFocused){if(e.target!==a.$control_input[0]){if(a.settings.mode==='single'){a.isOpen?a.close():a.open()}else if(!b){a.setActiveItem(null)}return false}}else{if(!b){window.setTimeout(function(){a.focus()},0)}}},onChange:function(){this.$input.trigger('change')},onPaste:function(e){var b=this;if(b.isFull()||b.isInputHidden||b.isLocked){e.preventDefault()}else{if(b.settings.splitOn){setTimeout(function(){var a=$.trim(b.$control_input.val()||'').split(b.settings.splitOn);for(var i=0,n=a.length;i<n;i++){b.createItem(a[i])}},0)}}},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var a=String.fromCharCode(e.keyCode||e.which);if(this.settings.create&&this.settings.mode==='multi'&&a===this.settings.delimiter){this.createItem();e.preventDefault();return false}},onKeyDown:function(e){var a=e.target===this.$control_input[0];var b=this;if(b.isLocked){if(e.keyCode!==T){e.preventDefault()}return}switch(e.keyCode){case E:if(b.isCmdDown){b.selectAll();return}break;case H:if(b.isOpen){e.preventDefault();e.stopPropagation();b.close()}return;case N:if(!e.ctrlKey||e.altKey)break;case M:if(!b.isOpen&&b.hasOptions){b.open()}else if(b.$activeOption){b.ignoreHover=true;var c=b.getAdjacentOption(b.$activeOption,1);if(c.length)b.setActiveOption(c,true,true)}e.preventDefault();return;case K:if(!e.ctrlKey||e.altKey)break;case J:if(b.$activeOption){b.ignoreHover=true;var d=b.getAdjacentOption(b.$activeOption,-1);if(d.length)b.setActiveOption(d,true,true)}e.preventDefault();return;case G:if(b.isOpen&&b.$activeOption){b.onOptionSelect({currentTarget:b.$activeOption});e.preventDefault()}return;case I:b.advanceSelection(-1,e);return;case L:b.advanceSelection(1,e);return;case T:if(b.settings.selectOnTab&&b.isOpen&&b.$activeOption){b.onOptionSelect({currentTarget:b.$activeOption});if(!b.isFull()){e.preventDefault()}}if(b.settings.create&&b.createItem()){e.preventDefault()}return;case O:case P:b.deleteSelection(e);return}if((b.isFull()||b.isInputHidden)&&!(D?e.metaKey:e.ctrlKey)){e.preventDefault();return}},onKeyUp:function(e){var a=this;if(a.isLocked)return e&&e.preventDefault();var b=a.$control_input.val()||'';if(a.lastValue!==b){a.lastValue=b;a.onSearchChange(b);a.refreshOptions();a.trigger('type',b)}},onSearchChange:function(b){var c=this;var d=c.settings.load;if(!d)return;if(c.loadedSearches.hasOwnProperty(b))return;c.loadedSearches[b]=true;c.load(function(a){d.apply(c,[b,a])})},onFocus:function(e){var a=this;var b=a.isFocused;if(a.isDisabled){a.blur();e&&e.preventDefault();return false}if(a.ignoreFocus)return;a.isFocused=true;if(a.settings.preload==='focus')a.onSearchChange('');if(!b)a.trigger('focus');if(!a.$activeItems.length){a.showInput();a.setActiveItem(null);a.refreshOptions(!!a.settings.openOnFocus)}a.refreshState()},onBlur:function(e,a){var b=this;if(!b.isFocused)return;b.isFocused=false;if(b.ignoreFocus){return}else if(!b.ignoreBlur&&document.activeElement===b.$dropdown_content[0]){b.ignoreBlur=true;b.onFocus(e);return}var c=function(){b.close();b.setTextboxValue('');b.setActiveItem(null);b.setActiveOption(null);b.setCaret(b.items.length);b.refreshState();(a||document.body).focus();b.ignoreFocus=false;b.trigger('blur')};b.ignoreFocus=true;if(b.settings.create&&b.settings.createOnBlur){b.createItem(null,false,c)}else{c()}},onOptionHover:function(e){if(this.ignoreHover)return;this.setActiveOption(e.currentTarget,false)},onOptionSelect:function(e){var a,$target,$option,self=this;if(e.preventDefault){e.preventDefault();e.stopPropagation()}$target=$(e.currentTarget);if($target.hasClass('create')){self.createItem(null,function(){if(self.settings.closeAfterSelect){self.close()}})}else{a=$target.attr('data-value');if(typeof a!=='undefined'){self.lastQuery=null;self.setTextboxValue('');self.addItem(a);if(self.settings.closeAfterSelect){self.close()}else if(!self.settings.hideSelected&&e.type&&/mouse/.test(e.type)){self.setActiveOption(self.getOption(a))}}}},onItemSelect:function(e){var a=this;if(a.isLocked)return;if(a.settings.mode==='multi'){e.preventDefault();a.setActiveItem(e.currentTarget,e)}},load:function(b){var c=this;var d=c.$wrapper.addClass(c.settings.loadingClass);c.loading++;b.apply(c,[function(a){c.loading=Math.max(c.loading-1,0);if(a&&a.length){c.addOption(a);c.refreshOptions(c.isFocused&&!c.isInputHidden)}if(!c.loading){d.removeClass(c.settings.loadingClass)}c.trigger('load',a)}])},setTextboxValue:function(a){var b=this.$control_input;var c=b.val()!==a;if(c){b.val(a).triggerHandler('update');this.lastValue=a}},getValue:function(){if(this.tagType===U&&this.$input.attr('multiple')){return this.items}else{return this.items.join(this.settings.delimiter)}},setValue:function(a,b){var c=b?[]:['change'];be(this,c,function(){this.clear();this.addItems(a,b)})},setActiveItem:function(a,e){var b=this;var c;var i,idx,begin,end,item,swap;var d;if(b.settings.mode==='single')return;a=$(a);if(!a.length){$(b.$activeItems).removeClass('active');b.$activeItems=[];if(b.isFocused){b.showInput()}return}c=e&&e.type.toLowerCase();if(c==='mousedown'&&b.isShiftDown&&b.$activeItems.length){d=b.$control.children('.active:last');begin=Array.prototype.indexOf.apply(b.$control[0].childNodes,[d[0]]);end=Array.prototype.indexOf.apply(b.$control[0].childNodes,[a[0]]);if(begin>end){swap=begin;begin=end;end=swap}for(i=begin;i<=end;i++){item=b.$control[0].childNodes[i];if(b.$activeItems.indexOf(item)===-1){$(item).addClass('active');b.$activeItems.push(item)}}e.preventDefault()}else if((c==='mousedown'&&b.isCtrlDown)||(c==='keydown'&&this.isShiftDown)){if(a.hasClass('active')){idx=b.$activeItems.indexOf(a[0]);b.$activeItems.splice(idx,1);a.removeClass('active')}else{b.$activeItems.push(a.addClass('active')[0])}}else{$(b.$activeItems).removeClass('active');b.$activeItems=[a.addClass('active')[0]]}b.hideInput();if(!this.isFocused){b.focus()}},setActiveOption:function(a,b,c){var d,height_item,y;var e,scroll_bottom;var f=this;if(f.$activeOption)f.$activeOption.removeClass('active');f.$activeOption=null;a=$(a);if(!a.length)return;f.$activeOption=a.addClass('active');if(b||!X(b)){d=f.$dropdown_content.height();height_item=f.$activeOption.outerHeight(true);b=f.$dropdown_content.scrollTop()||0;y=f.$activeOption.offset().top-f.$dropdown_content.offset().top+b;e=y;scroll_bottom=y-d+height_item;if(y+height_item>d+b){f.$dropdown_content.stop().animate({scrollTop:scroll_bottom},c?f.settings.scrollDuration:0)}else if(y<b){f.$dropdown_content.stop().animate({scrollTop:e},c?f.settings.scrollDuration:0)}}},selectAll:function(){var a=this;if(a.settings.mode==='single')return;a.$activeItems=Array.prototype.slice.apply(a.$control.children(':not(input)').addClass('active'));if(a.$activeItems.length){a.hideInput();a.close()}a.focus()},hideInput:function(){var a=this;a.setTextboxValue('');a.$control_input.css({opacity:0,position:'absolute',left:a.rtl?10000:-10000});a.isInputHidden=true},showInput:function(){this.$control_input.css({opacity:1,position:'relative',left:0});this.isInputHidden=false},focus:function(){var a=this;if(a.isDisabled)return;a.ignoreFocus=true;a.$control_input[0].focus();window.setTimeout(function(){a.ignoreFocus=false;a.onFocus()},0)},blur:function(a){this.$control_input[0].blur();this.onBlur(null,a)},getScoreFunction:function(a){return this.sifter.getScoreFunction(a,this.getSearchOptions())},getSearchOptions:function(){var a=this.settings;var b=a.sortField;if(typeof b==='string'){b=[{field:b}]}return{fields:a.searchField,conjunction:a.searchConjunction,sort:b}},search:function(a){var i,value,score,result,calculateScore;var b=this;var c=b.settings;var d=this.getSearchOptions();if(c.score){calculateScore=b.settings.score.apply(this,[a]);if(typeof calculateScore!=='function'){throw new Error('Selectize "score" setting must be a function that returns a function');}}if(a!==b.lastQuery){b.lastQuery=a;result=b.sifter.search(a,$.extend(d,{score:calculateScore}));b.currentResults=result}else{result=$.extend(true,{},b.currentResults)}if(c.hideSelected){for(i=result.items.length-1;i>=0;i--){if(b.items.indexOf(Y(result.items[i].id))!==-1){result.items.splice(i,1)}}}return result},refreshOptions:function(e){var i,j,k,n,groups,groups_order,option,option_html,optgroup,optgroups,html,html_children,has_create_option;var f,$active_before,$create;if(typeof e==='undefined'){e=true}var g=this;var h=$.trim(g.$control_input.val());var l=g.search(h);var m=g.$dropdown_content;var o=g.$activeOption&&Y(g.$activeOption.attr('data-value'));n=l.items.length;if(typeof g.settings.maxOptions==='number'){n=Math.min(n,g.settings.maxOptions)}groups={};groups_order=[];for(i=0;i<n;i++){option=g.options[l.items[i].id];option_html=g.render('option',option);optgroup=option[g.settings.optgroupField]||'';optgroups=Array.isArray(optgroup)?optgroup:[optgroup];for(j=0,k=optgroups&&optgroups.length;j<k;j++){optgroup=optgroups[j];if(!g.optgroups.hasOwnProperty(optgroup)){optgroup=''}if(!groups.hasOwnProperty(optgroup)){groups[optgroup]=[];groups_order.push(optgroup)}groups[optgroup].push(option_html)}}if(this.settings.lockOptgroupOrder){groups_order.sort(function(a,b){var c=g.optgroups[a].$order||0;var d=g.optgroups[b].$order||0;return c-d})}html=[];for(i=0,n=groups_order.length;i<n;i++){optgroup=groups_order[i];if(g.optgroups.hasOwnProperty(optgroup)&&groups[optgroup].length){html_children=g.render('optgroup_header',g.optgroups[optgroup])||'';html_children+=groups[optgroup].join('');html.push(g.render('optgroup',$.extend({},g.optgroups[optgroup],{html:html_children})))}else{html.push(groups[optgroup].join(''))}}m.html(html.join(''));if(g.settings.highlight&&l.query.length&&l.tokens.length){for(i=0,n=l.tokens.length;i<n;i++){B(m,l.tokens[i].regex)}}if(!g.settings.hideSelected){for(i=0,n=g.items.length;i<n;i++){g.getOption(g.items[i]).addClass('selected')}}has_create_option=g.canCreate(h);if(has_create_option){m.prepend(g.render('option_create',{input:h}));$create=$(m[0].childNodes[0])}g.hasOptions=l.items.length>0||has_create_option;if(g.hasOptions){if(l.items.length>0){$active_before=o&&g.getOption(o);if($active_before&&$active_before.length){f=$active_before}else if(g.settings.mode==='single'&&g.items.length){f=g.getOption(g.items[0])}if(!f||!f.length){if($create&&!g.settings.addPrecedence){f=g.getAdjacentOption($create,1)}else{f=m.find('[data-selectable]:first')}}}else{f=$create}g.setActiveOption(f);if(e&&!g.isOpen){g.open()}}else{g.setActiveOption(null);if(e&&g.isOpen){g.close()}}},addOption:function(a){var i,n,value,self=this;if(Array.isArray(a)){for(i=0,n=a.length;i<n;i++){self.addOption(a[i])}return}if(value=self.registerOption(a)){self.userOptions[value]=true;self.lastQuery=null;self.trigger('option_add',value,a)}},registerOption:function(a){var b=Y(a[this.settings.valueField]);if(!b||this.options.hasOwnProperty(b))return false;a.$order=a.$order||++this.order;this.options[b]=a;return b},registerOptionGroup:function(a){var b=Y(a[this.settings.optgroupValueField]);if(!b)return false;a.$order=a.$order||++this.order;this.optgroups[b]=a;return b},addOptionGroup:function(a,b){b[this.settings.optgroupValueField]=a;if(a=this.registerOptionGroup(b)){this.trigger('optgroup_add',a,b)}},removeOptionGroup:function(a){if(this.optgroups.hasOwnProperty(a)){delete this.optgroups[a];this.renderCache={};this.trigger('optgroup_remove',a)}},clearOptionGroups:function(){this.optgroups={};this.renderCache={};this.trigger('optgroup_clear')},updateOption:function(a,b){var c=this;var d,$item_new;var e,index_item,cache_items,cache_options,order_old;a=Y(a);e=Y(b[c.settings.valueField]);if(a===null)return;if(!c.options.hasOwnProperty(a))return;if(typeof e!=='string')throw new Error('Value must be set in option data');order_old=c.options[a].$order;if(e!==a){delete c.options[a];index_item=c.items.indexOf(a);if(index_item!==-1){c.items.splice(index_item,1,e)}}b.$order=b.$order||order_old;c.options[e]=b;cache_items=c.renderCache['item'];cache_options=c.renderCache['option'];if(cache_items){delete cache_items[a];delete cache_items[e]}if(cache_options){delete cache_options[a];delete cache_options[e]}if(c.items.indexOf(e)!==-1){d=c.getItem(a);$item_new=$(c.render('item',b));if(d.hasClass('active'))$item_new.addClass('active');d.replaceWith($item_new)}c.lastQuery=null;if(c.isOpen){c.refreshOptions(false)}},removeOption:function(a,b){var c=this;a=Y(a);var d=c.renderCache['item'];var e=c.renderCache['option'];if(d)delete d[a];if(e)delete e[a];delete c.userOptions[a];delete c.options[a];c.lastQuery=null;c.trigger('option_remove',a);c.removeItem(a,b)},clearOptions:function(){var a=this;a.loadedSearches={};a.userOptions={};a.renderCache={};a.options=a.sifter.items={};a.lastQuery=null;a.trigger('option_clear');a.clear()},getOption:function(a){return this.getElementWithValue(a,this.$dropdown_content.find('[data-selectable]'))},getAdjacentOption:function(a,b){var c=this.$dropdown.find('[data-selectable]');var d=c.index(a)+b;return d>=0&&d<c.length?c.eq(d):$()},getElementWithValue:function(a,b){a=Y(a);if(typeof a!=='undefined'&&a!==null){for(var i=0,n=b.length;i<n;i++){if(b[i].getAttribute('data-value')===a){return $(b[i])}}}return $()},getItem:function(a){return this.getElementWithValue(a,this.$control.children())},addItems:function(a,b){var c=Array.isArray(a)?a:[a];for(var i=0,n=c.length;i<n;i++){this.isPending=(i<n-1);this.addItem(c[i],b)}},addItem:function(d,e){var f=e?[]:['change'];be(this,f,function(){var a,$option,$options;var b=this;var c=b.settings.mode;var i,active,value_next,wasFull;d=Y(d);if(b.items.indexOf(d)!==-1){if(c==='single')b.close();return}if(!b.options.hasOwnProperty(d))return;if(c==='single')b.clear();if(c==='multi'&&b.isFull())return;a=$(b.render('item',b.options[d]));wasFull=b.isFull();b.items.splice(b.caretPos,0,d);b.insertAtCaret(a);if(!b.isPending||(!wasFull&&b.isFull())){b.refreshState()}if(b.isSetup){$options=b.$dropdown_content.find('[data-selectable]');if(!b.isPending){$option=b.getOption(d);value_next=b.getAdjacentOption($option,1).attr('data-value');b.refreshOptions(b.isFocused&&c!=='single');if(value_next){b.setActiveOption(b.getOption(value_next))}}if(!$options.length||b.isFull()){b.close()}else{b.positionDropdown()}b.updatePlaceholder();b.trigger('item_add',d,a);b.updateOriginalInput({silent:e})}})},removeItem:function(a,b){var c=this;var d,i,idx;d=(typeof a==='object')?a:c.getItem(a);a=Y(d.attr('data-value'));i=c.items.indexOf(a);if(i!==-1){d.remove();if(d.hasClass('active')){idx=c.$activeItems.indexOf(d[0]);c.$activeItems.splice(idx,1)}c.items.splice(i,1);c.lastQuery=null;if(!c.settings.persist&&c.userOptions.hasOwnProperty(a)){c.removeOption(a,b)}if(i<c.caretPos){c.setCaret(c.caretPos-1)}c.refreshState();c.updatePlaceholder();c.updateOriginalInput({silent:b});c.positionDropdown();c.trigger('item_remove',a,d)}},createItem:function(c,d){var e=this;var f=e.caretPos;c=c||$.trim(e.$control_input.val()||'');var g=arguments[arguments.length-1];if(typeof g!=='function')g=function(){};if(typeof d!=='boolean'){d=true}if(!e.canCreate(c)){g();return false}e.lock();var h=(typeof e.settings.create==='function')?this.settings.create:function(a){var b={};b[e.settings.labelField]=a;b[e.settings.valueField]=a;return b};var i=bc(function(a){e.unlock();if(!a||typeof a!=='object')return g();var b=Y(a[e.settings.valueField]);if(typeof b!=='string')return g();e.setTextboxValue('');e.addOption(a);e.setCaret(f);e.addItem(b);e.refreshOptions(d&&e.settings.mode!=='single');g(a)});var j=h.apply(this,[c,i]);if(typeof j!=='undefined'){i(j)}return true},refreshItems:function(){this.lastQuery=null;if(this.isSetup){this.addItem(this.items)}this.refreshState();this.updateOriginalInput()},refreshState:function(){var a,self=this;if(self.isRequired){if(self.items.length)self.isInvalid=false;self.$control_input.prop('required',a)}self.refreshClasses()},refreshClasses:function(){var a=this;var b=a.isFull();var c=a.isLocked;a.$wrapper.toggleClass('rtl',a.rtl);a.$control.toggleClass('focus',a.isFocused).toggleClass('disabled',a.isDisabled).toggleClass('required',a.isRequired).toggleClass('invalid',a.isInvalid).toggleClass('locked',c).toggleClass('full',b).toggleClass('not-full',!b).toggleClass('input-active',a.isFocused&&!a.isInputHidden).toggleClass('dropdown-active',a.isOpen).toggleClass('has-options',!$.isEmptyObject(a.options)).toggleClass('has-items',a.items.length>0);a.$control_input.data('grow',!b&&!c)},isFull:function(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(a){var i,n,options,label,self=this;a=a||{};if(self.tagType===U){options=[];for(i=0,n=self.items.length;i<n;i++){label=self.options[self.items[i]][self.settings.labelField]||'';options.push('<option value="'+Z(self.items[i])+'" selected="selected">'+Z(label)+'</option>')}if(!options.length&&!this.$input.attr('multiple')){options.push('<option value="" selected="selected"></option>')}self.$input.html(options.join(''))}else{self.$input.val(self.getValue());self.$input.attr('value',self.$input.val())}if(self.isSetup){if(!a.silent){self.trigger('change',self.$input.val())}}},updatePlaceholder:function(){if(!this.settings.placeholder)return;var a=this.$control_input;if(this.items.length){a.removeAttr('placeholder')}else{a.attr('placeholder',this.settings.placeholder)}a.triggerHandler('update',{force:true})},open:function(){var a=this;if(a.isLocked||a.isOpen||(a.settings.mode==='multi'&&a.isFull()))return;a.focus();a.isOpen=true;a.refreshState();a.$dropdown.css({visibility:'hidden',display:'block'});a.positionDropdown();a.$dropdown.css({visibility:'visible'});a.trigger('dropdown_open',a.$dropdown)},close:function(){var a=this;var b=a.isOpen;if(a.settings.mode==='single'&&a.items.length){a.hideInput()}a.isOpen=false;a.$dropdown.hide();a.setActiveOption(null);a.refreshState();if(b)a.trigger('dropdown_close',a.$dropdown)},positionDropdown:function(){var a=this.$control;var b=this.settings.dropdownParent==='body'?a.offset():a.position();b.top+=a.outerHeight(true);this.$dropdown.css({width:a.outerWidth(),top:b.top,left:b.left})},clear:function(a){var b=this;if(!b.items.length)return;b.$control.children(':not(input)').remove();b.items=[];b.lastQuery=null;b.setCaret(0);b.setActiveItem(null);b.updatePlaceholder();b.updateOriginalInput({silent:a});b.refreshState();b.showInput();b.trigger('clear')},insertAtCaret:function(a){var b=Math.min(this.caretPos,this.items.length);if(b===0){this.$control.prepend(a)}else{$(this.$control[0].childNodes[b]).before(a)}this.setCaret(b+1)},deleteSelection:function(e){var i,n,direction,selection,values,caret,option_select,$option_select,$tail;var a=this;direction=(e&&e.keyCode===O)?-1:1;selection=bg(a.$control_input[0]);if(a.$activeOption&&!a.settings.hideSelected){option_select=a.getAdjacentOption(a.$activeOption,-1).attr('data-value')}values=[];if(a.$activeItems.length){$tail=a.$control.children('.active:'+(direction>0?'last':'first'));caret=a.$control.children(':not(input)').index($tail);if(direction>0){caret++}for(i=0,n=a.$activeItems.length;i<n;i++){values.push($(a.$activeItems[i]).attr('data-value'))}if(e){e.preventDefault();e.stopPropagation()}}else if((a.isFocused||a.settings.mode==='single')&&a.items.length){if(direction<0&&selection.start===0&&selection.length===0){values.push(a.items[a.caretPos-1])}else if(direction>0&&selection.start===a.$control_input.val().length){values.push(a.items[a.caretPos])}}if(!values.length||(typeof a.settings.onDelete==='function'&&a.settings.onDelete.apply(a,[values])===false)){return false}if(typeof caret!=='undefined'){a.setCaret(caret)}while(values.length){a.removeItem(values.pop())}a.showInput();a.positionDropdown();a.refreshOptions(true);if(option_select){$option_select=a.getOption(option_select);if($option_select.length){a.setActiveOption($option_select)}}return true},advanceSelection:function(a,e){var b,selection,idx,valueLength,cursorAtEdge,$tail;var c=this;if(a===0)return;if(c.rtl)a*=-1;b=a>0?'last':'first';selection=bg(c.$control_input[0]);if(c.isFocused&&!c.isInputHidden){valueLength=c.$control_input.val().length;cursorAtEdge=a<0?selection.start===0&&selection.length===0:selection.start===valueLength;if(cursorAtEdge&&!valueLength){c.advanceCaret(a,e)}}else{$tail=c.$control.children('.active:'+b);if($tail.length){idx=c.$control.children(':not(input)').index($tail);c.setActiveItem(null);c.setCaret(a>0?idx+1:idx)}}},advanceCaret:function(a,e){var b=this,fn,$adj;if(a===0)return;fn=a>0?'next':'prev';if(b.isShiftDown){$adj=b.$control_input[fn]();if($adj.length){b.hideInput();b.setActiveItem($adj);e&&e.preventDefault()}}else{b.setCaret(b.caretPos+a)}},setCaret:function(i){var a=this;if(a.settings.mode==='single'){i=a.items.length}else{i=Math.max(0,Math.min(a.items.length,i))}if(!a.isPending){var j,n,fn,$children,$child;$children=a.$control.children(':not(input)');for(j=0,n=$children.length;j<n;j++){$child=$($children[j]).detach();if(j<i){a.$control_input.before($child)}else{a.$control.append($child)}}}a.caretPos=i},lock:function(){this.close();this.isLocked=true;this.refreshState()},unlock:function(){this.isLocked=false;this.refreshState()},disable:function(){var a=this;a.$input.prop('disabled',true);a.$control_input.prop('disabled',true).prop('tabindex',-1);a.isDisabled=true;a.lock()},enable:function(){var a=this;a.$input.prop('disabled',false);a.$control_input.prop('disabled',false).prop('tabindex',a.tabIndex);a.isDisabled=false;a.unlock()},destroy:function(){var a=this;var b=a.eventNS;var c=a.revertSettings;a.trigger('destroy');a.off();a.$wrapper.remove();a.$dropdown.remove();a.$input.html('').append(c.$children).removeAttr('tabindex').removeClass('selectized').attr({tabindex:c.tabindex}).show();a.$control_input.removeData('grow');a.$input.removeData('selectize');$(window).off(b);$(document).off(b);$(document.body).off(b);delete a.$input[0].selectize},render:function(a,b){var c,id,label;var d='';var e=false;var f=this;var g=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(a==='option'||a==='item'){c=Y(b[f.settings.valueField]);e=!!c}if(e){if(!X(f.renderCache[a])){f.renderCache[a]={}}if(f.renderCache[a].hasOwnProperty(c)){return f.renderCache[a][c]}}d=f.settings.render[a].apply(this,[b,Z]);if(a==='option'||a==='option_create'){d=d.replace(g,'<$1 data-selectable')}if(a==='optgroup'){id=b[f.settings.optgroupValueField]||'';d=d.replace(g,'<$1 data-group="'+ba(Z(id))+'"')}if(a==='option'||a==='item'){d=d.replace(g,'<$1 data-value="'+ba(Z(c||''))+'"')}if(e){f.renderCache[a][c]=d}return d},clearCache:function(a){var b=this;if(typeof a==='undefined'){b.renderCache={}}else{delete b.renderCache[a]}},canCreate:function(a){var b=this;if(!b.settings.create)return false;var c=b.settings.createFilter;return a.length&&(typeof c!=='function'||c.apply(b,[a]))&&(typeof c!=='string'||new RegExp(c).test(a))&&(!(c instanceof RegExp)||c.test(a))}});bk.count=0;bk.defaults={options:[],optgroups:[],plugins:[],delimiter:',',splitOn:null,persist:true,diacritics:true,create:false,createOnBlur:false,createFilter:null,highlight:true,openOnFocus:true,maxOptions:1000,maxItems:null,hideSelected:null,addPrecedence:false,selectOnTab:false,preload:false,allowEmptyOption:false,closeAfterSelect:false,scrollDuration:60,loadThrottle:300,loadingClass:'loading',dataAttr:'data-data',optgroupField:'optgroup',valueField:'value',labelField:'text',optgroupLabelField:'label',optgroupValueField:'value',lockOptgroupOrder:false,sortField:'$order',searchField:['text'],searchConjunction:'and',mode:null,wrapperClass:'selectize-control',inputClass:'selectize-input',dropdownClass:'selectize-dropdown',dropdownContentClass:'selectize-dropdown-content',dropdownParent:null,copyClassesToDropdown:true,render:{}};$.fn.selectize=function(m){var o=$.fn.selectize.defaults;var p=$.extend({},o,m);var q=p.dataAttr;var r=p.labelField;var s=p.valueField;var t=p.optgroupField;var u=p.optgroupLabelField;var v=p.optgroupValueField;var w={};var x=function(a,b){var i,n,values,option;var c=a.attr(q);if(!c){var d=$.trim(a.val()||'');if(!p.allowEmptyOption&&!d.length)return;values=d.split(p.delimiter);for(i=0,n=values.length;i<n;i++){option={};option[r]=values[i];option[s]=values[i];b.options.push(option)}b.items=values}else{b.options=JSON.parse(c);for(i=0,n=b.options.length;i<n;i++){b.items.push(b.options[i][s])}}};var y=function(f,g){var i,n,tagName,$children,order=0;var h=g.options;var j=function(a){var b=q&&a.attr(q);if(typeof b==='string'&&b.length){return JSON.parse(b)}return null};var k=function(a,b){a=$(a);var c=Y(a.attr('value'));if(!c&&!p.allowEmptyOption)return;if(w.hasOwnProperty(c)){if(b){var d=w[c][t];if(!d){w[c][t]=b}else if(!Array.isArray(d)){w[c][t]=[d,b]}else{d.push(b)}}return}var e=j(a)||{};e[r]=e[r]||a.text();e[s]=e[s]||c;e[t]=e[t]||b;w[c]=e;h.push(e);if(a.is(':selected')){g.items.push(c)}};var l=function(a){var i,n,id,optgroup,$options;a=$(a);id=a.attr('label');if(id){optgroup=j(a)||{};optgroup[u]=id;optgroup[v]=id;g.optgroups.push(optgroup)}$options=$('option',a);for(i=0,n=$options.length;i<n;i++){k($options[i],id)}};g.maxItems=f.attr('multiple')?null:1;$children=f.children();for(i=0,n=$children.length;i<n;i++){tagName=$children[i].tagName.toLowerCase();if(tagName==='optgroup'){l($children[i])}else if(tagName==='option'){k($children[i])}}};return this.each(function(){if(this.selectize)return;var a;var b=$(this);var c=this.tagName.toLowerCase();var d=b.attr('placeholder')||b.attr('data-placeholder');if(!d&&!p.allowEmptyOption){d=b.children('option[value=""]').text()}var e={'placeholder':d,'options':[],'optgroups':[],'items':[]};if(c==='select'){y(b,e)}else{x(b,e)}a=new bk(b,$.extend(true,{},o,e,m))})};$.fn.selectize.defaults=bk.defaults;$.fn.selectize.support={validity:W};bk.define('drag_drop',function(f){if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(this.settings.mode!=='multi')return;var g=this;g.lock=(function(){var b=g.lock;return function(){var a=g.$control.data('sortable');if(a)a.disable();return b.apply(g,arguments)}})();g.unlock=(function(){var b=g.unlock;return function(){var a=g.$control.data('sortable');if(a)a.enable();return b.apply(g,arguments)}})();g.setup=(function(){var d=g.setup;return function(){d.apply(this,arguments);var c=g.$control.sortable({items:'[data-value]',forcePlaceholderSize:true,disabled:g.isLocked,start:function(e,a){a.placeholder.css('width',a.helper.css('width'));c.css({overflow:'visible'})},stop:function(){c.css({overflow:'hidden'});var a=g.$activeItems?g.$activeItems.slice():null;var b=[];c.children('[data-value]').each(function(){b.push($(this).attr('data-value'))});g.setValue(b);g.setActiveItem(a)}})}})()});bk.define('dropdown_header',function(b){var c=this;b=$.extend({title:'Untitled',headerClass:'selectize-dropdown-header',titleRowClass:'selectize-dropdown-header-title',labelClass:'selectize-dropdown-header-label',closeClass:'selectize-dropdown-header-close',html:function(a){return('<div class="'+a.headerClass+'">'+'<div class="'+a.titleRowClass+'">'+'<span class="'+a.labelClass+'">'+a.title+'</span>'+'<a href="javascript:void(0)" class="'+a.closeClass+'">&times;</a>'+'</div>'+'</div>')}},b);c.setup=(function(){var a=c.setup;return function(){a.apply(c,arguments);c.$dropdown_header=$(b.html(b));c.$dropdown.prepend(c.$dropdown_header)}})()});bk.define('optgroup_columns',function(f){var g=this;f=$.extend({equalizeWidth:true,equalizeHeight:true},f);this.getAdjacentOption=function(a,b){var c=a.closest('[data-group]').find('[data-selectable]');var d=c.index(a)+b;return d>=0&&d<c.length?c.eq(d):$()};this.onKeyDown=(function(){var b=g.onKeyDown;return function(e){var a,$option,$options,$optgroup;if(this.isOpen&&(e.keyCode===I||e.keyCode===L)){g.ignoreHover=true;$optgroup=this.$activeOption.closest('[data-group]');a=$optgroup.find('[data-selectable]').index(this.$activeOption);if(e.keyCode===I){$optgroup=$optgroup.prev('[data-group]')}else{$optgroup=$optgroup.next('[data-group]')}$options=$optgroup.find('[data-selectable]');$option=$options.eq(Math.min($options.length-1,a));if($option.length){this.setActiveOption($option)}return}return b.apply(this,arguments)}})();var h=function(){var a;var b=h.width;var c=document;if(typeof b==='undefined'){a=c.createElement('div');a.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>';a=a.firstChild;c.body.appendChild(a);b=h.width=a.offsetWidth-a.clientWidth;c.body.removeChild(a)}return b};var j=function(){var i,n,height_max,width,width_last,width_parent,$optgroups;$optgroups=$('[data-group]',g.$dropdown_content);n=$optgroups.length;if(!n||!g.$dropdown_content.width())return;if(f.equalizeHeight){height_max=0;for(i=0;i<n;i++){height_max=Math.max(height_max,$optgroups.eq(i).height())}$optgroups.css({height:height_max})}if(f.equalizeWidth){width_parent=g.$dropdown_content.innerWidth()-h();width=Math.round(width_parent/n);$optgroups.css({width:width});if(n>1){width_last=width_parent-width*(n-1);$optgroups.eq(n-1).css({width:width_last})}}};if(f.equalizeHeight||f.equalizeWidth){bb.after(this,'positionDropdown',j);bb.after(this,'refreshOptions',j)}});bk.define('remove_button',function(d){if(this.settings.mode==='single')return;d=$.extend({label:'&times;',title:'Remove',className:'remove',append:true},d);var f=this;var g='<a href="javascript:void(0)" class="'+d.className+'" tabindex="-1" title="'+Z(d.title)+'">'+d.label+'</a>';var h=function(a,b){var c=a.search(/(<\/[^>]+>\s*)$/);return a.substring(0,c)+b+a.substring(c)};this.setup=(function(){var c=f.setup;return function(){if(d.append){var b=f.settings.render.item;f.settings.render.item=function(a){return h(b.apply(this,arguments),g)}}c.apply(this,arguments);this.$control.on('click','.'+d.className,function(e){e.preventDefault();if(f.isLocked)return;var a=$(e.currentTarget).parent();f.setActiveItem(a);if(f.deleteSelection()){f.setCaret(f.items.length)}})}})()});bk.define('restore_on_backspace',function(c){var d=this;c.text=c.text||function(a){return a[this.settings.labelField]};this.onKeyDown=(function(){var b=d.onKeyDown;return function(e){var a,option;if(e.keyCode===O&&this.$control_input.val()===''&&!this.$activeItems.length){a=this.caretPos-1;if(a>=0&&a<this.items.length){option=this.options[this.items[a]];if(this.deleteSelection(e)){this.setTextboxValue(c.text.apply(this,[option]));this.refreshOptions(true)}e.preventDefault();return}}return b.apply(this,arguments)}})()});return bk}));
