(function($){var o={};var p={};var q=null;var r=null;var s=null;var t=null;var u=null;o.init=function(l){var m=this;p=$.extend({},$.fn.timezonePicker.defaults,l);q=p.timezone;u=p.changeHandler;return m.each(function(i,j){r=j;s=document.getElementsByName(r.useMap.replace(/^#/,''))[0];$(r).wrap('<div class="timezone-picker"></div>').parent().css({position:'relative',width:$(r).width()+'px'});if(p.pinUrl){t=$('<img src="'+p.pinUrl+'" />').appendTo(r.parentNode).css('display','none')}else if(p.pin){t=$(r).parent().parent().find(p.pin).appendTo(r.parentNode).css('display','none')}$(s).find('area').click(function(){var a=this;if(t){t.css('display','block');var b=$(a).attr('data-pin').split(',');var c=t.hiddendims();var d=parseInt(c.outerWidth/2);var e=c.outerHeight;t.css({position:'absolute',left:(b[0]-d)+'px',top:(b[1]-e)+'px'})}var f=$(a).attr('data-timezone');var g=$(a).attr('data-country');var h=$(a).attr('data-offset');if(p.target){if(f)$(p.target).val(f)}if(p.countryTarget){if(g)$(p.countryTarget).val(g)}if(typeof u==='function'){u(f,g,h)}return false});if(p.target){$(p.target).bind('change',function(){m.timezonePicker('updateTimezone',$(this).val())})}if(p.countryTarget&&p.countryGuess){$(p.countryTarget).bind('change',function(){var a=$(this).val();if(p.countryGuesses[a]){$(s).find('area[data-timezone="'+p.countryGuesses[a]+'"]').click()}else{$(s).find('area[data-country='+a+']:first').click()}})}if(p.responsive){var k=null;$(window).resize(function(){if(k){clearTimeout(k)}k=setTimeout(function(){m.timezonePicker('resize')},200)})}setTimeout(function(){if(p.responsive&&parseInt(r.width)!==parseInt(r.getAttribute('width'))){m.timezonePicker('resize')}else if(p.maphilight&&$.fn.maphilight){$(r).maphilight(p)}if(p.target){$(p.target).triggerHandler('change')}},500);m.configured=true})};o.updateTimezone=function(b){q=b;t.css('display','none');$(s).find('area').each(function(m,a){if(a.getAttribute('data-timezone')===q){$(a).triggerHandler('click');return false}});return this};o.detectLocation=function(h){var k={success:undefined,error:undefined,complete:undefined};h=$.extend(k,h);if(navigator.geolocation){navigator.geolocation.getCurrentPosition(showPosition,handleErrors)}function showPosition(e){var f=$(r);var g=convertXY(e.coords.latitude,e.coords.longitude,f.width(),f.height());$(s).find('area').each(function(m,a){var b=a.getAttribute('coords').split(',');var c=a.getAttribute('shape');var d=[];for(var n=0;n<b.length/2;n++){d[n]=[b[n*2],b[n*2+1]]}if((c==='poly'&&isPointInPoly(d,g[0],g[1]))||(c==='rect'&&isPointInRect(b,g[0],g[1]))){$(a).triggerHandler('click',h['success']);return false}});if(h['complete']){h['complete'](e)}}function handleErrors(a){if(h['error']){h['error'](a)}if(h['complete']){h['complete'](a)}}function convertXY(a,b,c,d){var x=Math.round((b+180)*(c/360));var y=Math.round(((a*-1)+90)*(d/180));return[x,y]}function isPointInPoly(a,x,y){var b=false;var c=[1000000,1000000,-1000000,-1000000];for(var i=0,j=a.length-1;i<a.length;j=i++){var d=a[i][0],yi=a[i][1];var e=a[j][0],yj=a[j][1];c[0]=Math.min(c[0],d);c[1]=Math.min(c[1],yi);c[2]=Math.max(c[2],d);c[3]=Math.max(c[3],yi);var f=((yi>y)!=(yj>y))&&(x<(e-d)*(y-yi)/(yj-yi)+d);if(f)b=!b}return b&&isPointInRect(c,x,y)}function isPointInRect(a,x,y){a=[Math.min(a[0],a[2]),Math.min(a[1],a[3]),Math.max(a[0],a[2]),Math.max(a[1],a[3])];return(x>=a[0]&&x<=a[2]&&y>=a[1]&&y<=a[2])}return this};o.resize=function(){$(s).find('area').each(function(m,a){if(!a.originalCoords){a.originalCoords={timezone:a.getAttribute('data-timezone'),country:a.getAttribute('data-country'),coords:a.getAttribute('coords'),pin:a.getAttribute('data-pin')}}var b=r.width/r.getAttribute('width');$(r).parent().css({width:$(r).width()+'px'});var c=a.originalCoords.coords.split(',');var d=new Array();for(var j=0;j<c.length;j++){d[j]=Math.round(parseInt(c[j])*b)}a.setAttribute('coords',d.join(','));var e=a.originalCoords.pin.split(',');e[0]=Math.round(parseInt(e[0])*b);e[1]=Math.round(parseInt(e[1])*b);a.setAttribute('data-pin',e.join(','));if(p.target){$(p.target).triggerHandler('change')}});return this};$.fn.timezonePicker=function(a){if(o[a]){return o[a].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof a==='object'||!a){return o.init.apply(this,arguments)}else{$.error('Method '+a+' does not exist on jQuery.timezonePicker')}};$.fn.timezonePicker.defaults={pin:'.timezone-pin',pinUrl:null,timezone:null,maphilight:true,target:null,countryTarget:null,countryGuess:true,countryGuesses:{'AU':'Australia/Sydney','BR':'America/Sao_Paulo','CA':'America/Toronto','CN':'Asia/Shanghai','ES':'Europe/Madrid','MX':'America/Mexico_City','RU':'Europe/Moscow','US':'America/New_York'},responsive:false,fade:false,stroke:true,strokeColor:'FFFFFF',strokeOpacity:0.4,fillColor:'FFFFFF',fillOpacity:0.4,groupBy:'data-offset',}})(jQuery);
